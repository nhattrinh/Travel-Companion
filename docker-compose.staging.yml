# Docker Compose configuration for staging environment

version: '3.8'

services:
  menu-translation-backend:
    build:
      target: runtime
      args:
        ENVIRONMENT: staging
    environment:
      - ENVIRONMENT=staging
      - DEBUG=false
      - LOG_LEVEL=INFO
      - WORKERS=2
    volumes:
      # Staging volumes
      - app_logs:/app/logs
      - app_temp:/app/temp
      - app_models:/app/models
      - ./.env.staging:/app/.env.staging:ro
    command: ["python", "run.py", "--env", "staging"]
    deploy:
      resources:
        limits:
          cpus: '1.0'
          memory: 1G
        reservations:
          cpus: '0.5'
          memory: 512M

  redis:
    deploy:
      resources:
        limits:
          cpus: '0.25'
          memory: 256M

  # Include Redis UI for staging debugging
  redis-commander:
    profiles: []